package se.phan.redacted.textengine.parser

import ch.tutteli.atrium.api.fluent.en_GB.toContainExactly
import ch.tutteli.atrium.api.verbs.expect
import se.phan.redacted.textengine.Newline
import se.phan.redacted.textengine.Punctuation
import se.phan.redacted.textengine.Space
import se.phan.redacted.textengine.Word
import kotlin.test.Test

class TextParserWikipediaNovelTest {

    @Test
    fun `parse wikipedia novel entry`() {
        val str = """
            Dune is a 1965 epic science fiction novel by American author Frank Herbert, originally published as two separate serials in Analog magazine. It tied with Roger Zelazny's This Immortal for the Hugo Award in 1966 and it won the inaugural Nebula Award for Best Novel. It is the first installment of the Dune saga. In 2003, it was described as the world's best-selling science fiction novel.

            Dune is set in the distant future amidst a feudal interstellar society in which various noble houses control planetary fiefs. It tells the story of young Paul Atreides, whose family accepts the stewardship of the planet Arrakis. While the planet is an inhospitable and sparsely populated desert wasteland, it is the only source of melange, or "spice", a drug that extends life and enhances mental abilities. Melange is also necessary for space navigation, which requires a kind of multidimensional awareness and foresight that only the drug provides. As melange can only be produced on Arrakis, control of the planet is a coveted and dangerous undertaking. The story explores the multilayered interactions of politics, religion, ecology, technology, and human emotion, as the factions of the empire confront each other in a struggle for the control of Arrakis and its spice.

            Herbert wrote five sequels: Dune Messiah, Children of Dune, God Emperor of Dune, Heretics of Dune, and Chapterhouse: Dune. Following Herbert's death in 1986, his son Brian Herbert and author Kevin J. Anderson continued the series in over a dozen additional novels since 1999.

            Adaptations of the novel to cinema have been notoriously difficult and complicated. In the 1970s, cult filmmaker Alejandro Jodorowsky attempted to make a film based on the novel. After three years of development, the project was canceled due to a constantly growing budget. In 1984, a film adaptation directed by David Lynch was released to a mostly negative response from critics and failed at the box office. The book was also adapted into the 2000 Sci-Fi Channel miniseries Frank Herbert's Dune and its 2003 sequel Frank Herbert's Children of Dune (which combines the events of Dune Messiah and Children of Dune). A second film adaptation directed by Denis Villeneuve was released on October 21, 2021, to generally positive reviews from critics and grossed ${'$'}401 million worldwide. It also went on to win six Academy Awards. Villeneuve's film was essentially the first half of the original novel, and a sequel, which will cover the remaining story, has begun production and is set for release in 2023. The series has been used as the basis for several board, role-playing, and video games.

            Since 2009, the names of planets from the Dune novels have been adopted for the real-life nomenclature of plains and other features on Saturn's moon Titan.
        """.trimIndent()

        val text = TextParser.parse(str)

        expect(text.items).toContainExactly(
            Word.from("Dune"),
            Space,
            Word.from("is"),
            Space,
            Word.from("a"),
            Space,
            Word.from("1965"),
            Space,
            Word.from("epic"),
            Space,
            Word.from("science"),
            Space,
            Word.from("fiction"),
            Space,
            Word.from("novel"),
            Space,
            Word.from("by"),
            Space,
            Word.from("American"),
            Space,
            Word.from("author"),
            Space,
            Word.from("Frank"),
            Space,
            Word.from("Herbert"),
            Punctuation(','),
            Space,
            Word.from("originally"),
            Space,
            Word.from("published"),
            Space,
            Word.from("as"),
            Space,
            Word.from("two"),
            Space,
            Word.from("separate"),
            Space,
            Word.from("serials"),
            Space,
            Word.from("in"),
            Space,
            Word.from("Analog"),
            Space,
            Word.from("magazine"),
            Punctuation('.'),
            Space,

            Word.from("It"),
            Space,
            Word.from("tied"),
            Space,
            Word.from("with"),
            Space,
            Word.from("Roger"),
            Space,
            Word.from("Zelazny"),
            Punctuation('\''),
            Word.from("s"),
            Space,
            Word.from("This"),
            Space,
            Word.from("Immortal"),
            Space,
            Word.from("for"),
            Space,
            Word.from("the"),
            Space,
            Word.from("Hugo"),
            Space,
            Word.from("Award"),
            Space,
            Word.from("in"),
            Space,
            Word.from("1966"),
            Space,
            Word.from("and"),
            Space,
            Word.from("it"),
            Space,
            Word.from("won"),
            Space,
            Word.from("the"),
            Space,
            Word.from("inaugural"),
            Space,
            Word.from("Nebula"),
            Space,
            Word.from("Award"),
            Space,
            Word.from("for"),
            Space,
            Word.from("Best"),
            Space,
            Word.from("Novel"),
            Punctuation('.'),
            Space,

            Word.from("It"),
            Space,
            Word.from("is"),
            Space,
            Word.from("the"),
            Space,
            Word.from("first"),
            Space,
            Word.from("installment"),
            Space,
            Word.from("of"),
            Space,
            Word.from("the"),
            Space,
            Word.from("Dune"),
            Space,
            Word.from("saga"),
            Punctuation('.'),
            Space,

            Word.from("In"),
            Space,
            Word.from("2003"),
            Punctuation(','),
            Space,
            Word.from("it"),
            Space,
            Word.from("was"),
            Space,
            Word.from("described"),
            Space,
            Word.from("as"),
            Space,
            Word.from("the"),
            Space,
            Word.from("world"),
            Punctuation('\''),
            Word.from("s"),
            Space,
            Word.from("best"),
            Punctuation('-'),
            Word.from("selling"),
            Space,
            Word.from("science"),
            Space,
            Word.from("fiction"),
            Space,
            Word.from("novel"),
            Punctuation('.'),

            Newline,
            Newline,

            Word.from("Dune"),
            Space,
            Word.from("is"),
            Space,
            Word.from("set"),
            Space,
            Word.from("in"),
            Space,
            Word.from("the"),
            Space,
            Word.from("distant"),
            Space,
            Word.from("future"),
            Space,
            Word.from("amidst"),
            Space,
            Word.from("a"),
            Space,
            Word.from("feudal"),
            Space,
            Word.from("interstellar"),
            Space,
            Word.from("society"),
            Space,
            Word.from("in"),
            Space,
            Word.from("which"),
            Space,
            Word.from("various"),
            Space,
            Word.from("noble"),
            Space,
            Word.from("houses"),
            Space,
            Word.from("control"),
            Space,
            Word.from("planetary"),
            Space,
            Word.from("fiefs"),
            Punctuation('.'),
            Space,

            Word.from("It"),
            Space,
            Word.from("tells"),
            Space,
            Word.from("the"),
            Space,
            Word.from("story"),
            Space,
            Word.from("of"),
            Space,
            Word.from("young"),
            Space,
            Word.from("Paul"),
            Space,
            Word.from("Atreides"),
            Punctuation(','),
            Space,
            Word.from("whose"),
            Space,
            Word.from("family"),
            Space,
            Word.from("accepts"),
            Space,
            Word.from("the"),
            Space,
            Word.from("stewardship"),
            Space,
            Word.from("of"),
            Space,
            Word.from("the"),
            Space,
            Word.from("planet"),
            Space,
            Word.from("Arrakis"),
            Punctuation('.'),
            Space,

            Word.from("While"),
            Space,
            Word.from("the"),
            Space,
            Word.from("planet"),
            Space,
            Word.from("is"),
            Space,
            Word.from("an"),
            Space,
            Word.from("inhospitable"),
            Space,
            Word.from("and"),
            Space,
            Word.from("sparsely"),
            Space,
            Word.from("populated"),
            Space,
            Word.from("desert"),
            Space,
            Word.from("wasteland"),
            Punctuation(','),
            Space,
            Word.from("it"),
            Space,
            Word.from("is"),
            Space,
            Word.from("the"),
            Space,
            Word.from("only"),
            Space,
            Word.from("source"),
            Space,
            Word.from("of"),
            Space,
            Word.from("melange"),
            Punctuation(','),
            Space,
            Word.from("or"),
            Space,
            Punctuation('"'),
            Word.from("spice"),
            Punctuation('"'),
            Punctuation(','),
            Space,
            Word.from("a"),
            Space,
            Word.from("drug"),
            Space,
            Word.from("that"),
            Space,
            Word.from("extends"),
            Space,
            Word.from("life"),
            Space,
            Word.from("and"),
            Space,
            Word.from("enhances"),
            Space,
            Word.from("mental"),
            Space,
            Word.from("abilities"),
            Punctuation('.'),
            Space,

            Word.from("Melange"),
            Space,
            Word.from("is"),
            Space,
            Word.from("also"),
            Space,
            Word.from("necessary"),
            Space,
            Word.from("for"),
            Space,
            Word.from("space"),
            Space,
            Word.from("navigation"),
            Punctuation(','),
            Space,
            Word.from("which"),
            Space,
            Word.from("requires"),
            Space,
            Word.from("a"),
            Space,
            Word.from("kind"),
            Space,
            Word.from("of"),
            Space,
            Word.from("multidimensional"),
            Space,
            Word.from("awareness"),
            Space,
            Word.from("and"),
            Space,
            Word.from("foresight"),
            Space,
            Word.from("that"),
            Space,
            Word.from("only"),
            Space,
            Word.from("the"),
            Space,
            Word.from("drug"),
            Space,
            Word.from("provides"),
            Punctuation('.'),
            Space,

            Word.from("As"),
            Space,
            Word.from("melange"),
            Space,
            Word.from("can"),
            Space,
            Word.from("only"),
            Space,
            Word.from("be"),
            Space,
            Word.from("produced"),
            Space,
            Word.from("on"),
            Space,
            Word.from("Arrakis"),
            Punctuation(','),
            Space,
            Word.from("control"),
            Space,
            Word.from("of"),
            Space,
            Word.from("the"),
            Space,
            Word.from("planet"),
            Space,
            Word.from("is"),
            Space,
            Word.from("a"),
            Space,
            Word.from("coveted"),
            Space,
            Word.from("and"),
            Space,
            Word.from("dangerous"),
            Space,
            Word.from("undertaking"),
            Punctuation('.'),
            Space,

            Word.from("The"),
            Space,
            Word.from("story"),
            Space,
            Word.from("explores"),
            Space,
            Word.from("the"),
            Space,
            Word.from("multilayered"),
            Space,
            Word.from("interactions"),
            Space,
            Word.from("of"),
            Space,
            Word.from("politics"),
            Punctuation(','),
            Space,
            Word.from("religion"),
            Punctuation(','),
            Space,
            Word.from("ecology"),
            Punctuation(','),
            Space,
            Word.from("technology"),
            Punctuation(','),
            Space,
            Word.from("and"),
            Space,
            Word.from("human"),
            Space,
            Word.from("emotion"),
            Punctuation(','),
            Space,
            Word.from("as"),
            Space,
            Word.from("the"),
            Space,
            Word.from("factions"),
            Space,
            Word.from("of"),
            Space,
            Word.from("the"),
            Space,
            Word.from("empire"),
            Space,
            Word.from("confront"),
            Space,
            Word.from("each"),
            Space,
            Word.from("other"),
            Space,
            Word.from("in"),
            Space,
            Word.from("a"),
            Space,
            Word.from("struggle"),
            Space,
            Word.from("for"),
            Space,
            Word.from("the"),
            Space,
            Word.from("control"),
            Space,
            Word.from("of"),
            Space,
            Word.from("Arrakis"),
            Space,
            Word.from("and"),
            Space,
            Word.from("its"),
            Space,
            Word.from("spice"),
            Punctuation('.'),

            Newline,
            Newline,

            Word.from("Herbert"),
            Space,
            Word.from("wrote"),
            Space,
            Word.from("five"),
            Space,
            Word.from("sequels"),
            Punctuation(':'),
            Space,
            Word.from("Dune"),
            Space,
            Word.from("Messiah"),
            Punctuation(','),
            Space,
            Word.from("Children"),
            Space,
            Word.from("of"),
            Space,
            Word.from("Dune"),
            Punctuation(','),
            Space,
            Word.from("God"),
            Space,
            Word.from("Emperor"),
            Space,
            Word.from("of"),
            Space,
            Word.from("Dune"),
            Punctuation(','),
            Space,
            Word.from("Heretics"),
            Space,
            Word.from("of"),
            Space,
            Word.from("Dune"),
            Punctuation(','),
            Space,
            Word.from("and"),
            Space,
            Word.from("Chapterhouse"),
            Punctuation(':'),
            Space,
            Word.from("Dune"),
            Punctuation('.'),
            Space,

            Word.from("Following"),
            Space,
            Word.from("Herbert"),
            Punctuation('\''),
            Word.from("s"),
            Space,
            Word.from("death"),
            Space,
            Word.from("in"),
            Space,
            Word.from("1986"),
            Punctuation(','),
            Space,
            Word.from("his"),
            Space,
            Word.from("son"),
            Space,
            Word.from("Brian"),
            Space,
            Word.from("Herbert"),
            Space,
            Word.from("and"),
            Space,
            Word.from("author"),
            Space,
            Word.from("Kevin"),
            Space,
            Word.from("J"),
            Punctuation('.'),
            Space,
            Word.from("Anderson"),
            Space,
            Word.from("continued"),
            Space,
            Word.from("the"),
            Space,
            Word.from("series"),
            Space,
            Word.from("in"),
            Space,
            Word.from("over"),
            Space,
            Word.from("a"),
            Space,
            Word.from("dozen"),
            Space,
            Word.from("additional"),
            Space,
            Word.from("novels"),
            Space,
            Word.from("since"),
            Space,
            Word.from("1999"),
            Punctuation('.'),

            Newline,
            Newline,

            Word.from("Adaptations"),
            Space,
            Word.from("of"),
            Space,
            Word.from("the"),
            Space,
            Word.from("novel"),
            Space,
            Word.from("to"),
            Space,
            Word.from("cinema"),
            Space,
            Word.from("have"),
            Space,
            Word.from("been"),
            Space,
            Word.from("notoriously"),
            Space,
            Word.from("difficult"),
            Space,
            Word.from("and"),
            Space,
            Word.from("complicated"),
            Punctuation('.'),
            Space,

            Word.from("In"),
            Space,
            Word.from("the"),
            Space,
            Word.from("1970s"),
            Punctuation(','),
            Space,
            Word.from("cult"),
            Space,
            Word.from("filmmaker"),
            Space,
            Word.from("Alejandro"),
            Space,
            Word.from("Jodorowsky"),
            Space,
            Word.from("attempted"),
            Space,
            Word.from("to"),
            Space,
            Word.from("make"),
            Space,
            Word.from("a"),
            Space,
            Word.from("film"),
            Space,
            Word.from("based"),
            Space,
            Word.from("on"),
            Space,
            Word.from("the"),
            Space,
            Word.from("novel"),
            Punctuation('.'),
            Space,

            Word.from("After"),
            Space,
            Word.from("three"),
            Space,
            Word.from("years"),
            Space,
            Word.from("of"),
            Space,
            Word.from("development"),
            Punctuation(','),
            Space,
            Word.from("the"),
            Space,
            Word.from("project"),
            Space,
            Word.from("was"),
            Space,
            Word.from("canceled"),
            Space,
            Word.from("due"),
            Space,
            Word.from("to"),
            Space,
            Word.from("a"),
            Space,
            Word.from("constantly"),
            Space,
            Word.from("growing"),
            Space,
            Word.from("budget"),
            Punctuation('.'),
            Space,

            Word.from("In"),
            Space,
            Word.from("1984"),
            Punctuation(','),
            Space,
            Word.from("a"),
            Space,
            Word.from("film"),
            Space,
            Word.from("adaptation"),
            Space,
            Word.from("directed"),
            Space,
            Word.from("by"),
            Space,
            Word.from("David"),
            Space,
            Word.from("Lynch"),
            Space,
            Word.from("was"),
            Space,
            Word.from("released"),
            Space,
            Word.from("to"),
            Space,
            Word.from("a"),
            Space,
            Word.from("mostly"),
            Space,
            Word.from("negative"),
            Space,
            Word.from("response"),
            Space,
            Word.from("from"),
            Space,
            Word.from("critics"),
            Space,
            Word.from("and"),
            Space,
            Word.from("failed"),
            Space,
            Word.from("at"),
            Space,
            Word.from("the"),
            Space,
            Word.from("box"),
            Space,
            Word.from("office"),
            Punctuation('.'),
            Space,

            Word.from("The"),
            Space,
            Word.from("book"),
            Space,
            Word.from("was"),
            Space,
            Word.from("also"),
            Space,
            Word.from("adapted"),
            Space,
            Word.from("into"),
            Space,
            Word.from("the"),
            Space,
            Word.from("2000"),
            Space,
            Word.from("Sci"),
            Punctuation('-'),
            Word.from("Fi"),
            Space,
            Word.from("Channel"),
            Space,
            Word.from("miniseries"),
            Space,
            Word.from("Frank"),
            Space,
            Word.from("Herbert"),
            Punctuation('\''),
            Word.from("s"),
            Space,
            Word.from("Dune"),
            Space,
            Word.from("and"),
            Space,
            Word.from("its"),
            Space,
            Word.from("2003"),
            Space,
            Word.from("sequel"),
            Space,
            Word.from("Frank"),
            Space,
            Word.from("Herbert"),
            Punctuation('\''),
            Word.from("s"),
            Space,
            Word.from("Children"),
            Space,
            Word.from("of"),
            Space,
            Word.from("Dune"),
            Space,
            Punctuation('('),
            Word.from("which"),
            Space,
            Word.from("combines"),
            Space,
            Word.from("the"),
            Space,
            Word.from("events"),
            Space,
            Word.from("of"),
            Space,
            Word.from("Dune"),
            Space,
            Word.from("Messiah"),
            Space,
            Word.from("and"),
            Space,
            Word.from("Children"),
            Space,
            Word.from("of"),
            Space,
            Word.from("Dune"),
            Punctuation(')'),
            Punctuation('.'),
            Space,

            Word.from("A"),
            Space,
            Word.from("second"),
            Space,
            Word.from("film"),
            Space,
            Word.from("adaptation"),
            Space,
            Word.from("directed"),
            Space,
            Word.from("by"),
            Space,
            Word.from("Denis"),
            Space,
            Word.from("Villeneuve"),
            Space,
            Word.from("was"),
            Space,
            Word.from("released"),
            Space,
            Word.from("on"),
            Space,
            Word.from("October"),
            Space,
            Word.from("21"),
            Punctuation(','),
            Space,
            Word.from("2021"),
            Punctuation(','),
            Space,
            Word.from("to"),
            Space,
            Word.from("generally"),
            Space,
            Word.from("positive"),
            Space,
            Word.from("reviews"),
            Space,
            Word.from("from"),
            Space,
            Word.from("critics"),
            Space,
            Word.from("and"),
            Space,
            Word.from("grossed"),
            Space,
            Punctuation('$'),
            Word.from("401"),
            Space,
            Word.from("million"),
            Space,
            Word.from("worldwide"),
            Punctuation('.'),
            Space,

            Word.from("It"),
            Space,
            Word.from("also"),
            Space,
            Word.from("went"),
            Space,
            Word.from("on"),
            Space,
            Word.from("to"),
            Space,
            Word.from("win"),
            Space,
            Word.from("six"),
            Space,
            Word.from("Academy"),
            Space,
            Word.from("Awards"),
            Punctuation('.'),
            Space,

            Word.from("Villeneuve"),
            Punctuation('\''),
            Word.from("s"),
            Space,
            Word.from("film"),
            Space,
            Word.from("was"),
            Space,
            Word.from("essentially"),
            Space,
            Word.from("the"),
            Space,
            Word.from("first"),
            Space,
            Word.from("half"),
            Space,
            Word.from("of"),
            Space,
            Word.from("the"),
            Space,
            Word.from("original"),
            Space,
            Word.from("novel"),
            Punctuation(','),
            Space,
            Word.from("and"),
            Space,
            Word.from("a"),
            Space,
            Word.from("sequel"),
            Punctuation(','),
            Space,
            Word.from("which"),
            Space,
            Word.from("will"),
            Space,
            Word.from("cover"),
            Space,
            Word.from("the"),
            Space,
            Word.from("remaining"),
            Space,
            Word.from("story"),
            Punctuation(','),
            Space,
            Word.from("has"),
            Space,
            Word.from("begun"),
            Space,
            Word.from("production"),
            Space,
            Word.from("and"),
            Space,
            Word.from("is"),
            Space,
            Word.from("set"),
            Space,
            Word.from("for"),
            Space,
            Word.from("release"),
            Space,
            Word.from("in"),
            Space,
            Word.from("2023"),
            Punctuation('.'),
            Space,

            Word.from("The"),
            Space,
            Word.from("series"),
            Space,
            Word.from("has"),
            Space,
            Word.from("been"),
            Space,
            Word.from("used"),
            Space,
            Word.from("as"),
            Space,
            Word.from("the"),
            Space,
            Word.from("basis"),
            Space,
            Word.from("for"),
            Space,
            Word.from("several"),
            Space,
            Word.from("board"),
            Punctuation(','),
            Space,
            Word.from("role"),
            Punctuation('-'),
            Word.from("playing"),
            Punctuation(','),
            Space,
            Word.from("and"),
            Space,
            Word.from("video"),
            Space,
            Word.from("games"),
            Punctuation('.'),

            Newline,
            Newline,

            Word.from("Since"),
            Space,
            Word.from("2009"),
            Punctuation(','),
            Space,
            Word.from("the"),
            Space,
            Word.from("names"),
            Space,
            Word.from("of"),
            Space,
            Word.from("planets"),
            Space,
            Word.from("from"),
            Space,
            Word.from("the"),
            Space,
            Word.from("Dune"),
            Space,
            Word.from("novels"),
            Space,
            Word.from("have"),
            Space,
            Word.from("been"),
            Space,
            Word.from("adopted"),
            Space,
            Word.from("for"),
            Space,
            Word.from("the"),
            Space,
            Word.from("real"),
            Punctuation('-'),
            Word.from("life"),
            Space,
            Word.from("nomenclature"),
            Space,
            Word.from("of"),
            Space,
            Word.from("plains"),
            Space,
            Word.from("and"),
            Space,
            Word.from("other"),
            Space,
            Word.from("features"),
            Space,
            Word.from("on"),
            Space,
            Word.from("Saturn"),
            Punctuation('\''),
            Word.from("s"),
            Space,
            Word.from("moon"),
            Space,
            Word.from("Titan"),
            Punctuation('.')
        )
    }
}